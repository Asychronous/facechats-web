<!DOCTYPE html>
<html>
<head>
  <% include ./partials/header %>
</head>
<body>
  <% include ./partials/banner %>
  <div class="landing-section">
    <row centered>
      <column cols="6" class="inner-landing-section">
        <section class="intro-section text-centered">
          <span class="primary-color"><i class="fa fa-comment"></i> Face</span><span class="error-color">chats</span>.<br/><br/>
          Chat with the world anomously just in Facebook!<br/><br/>
          No extra apps, just use facebook messenger.<br><br/>
          <fb:login-button class="hidden-fb-login-btn" scope="public_profile,email" onlogin="checkLoginState();" style="display:none;"></fb:login-button>
          <span class="login-msg"></span>
          <button class="fb-login-btn" type="primary">Sign up with <i class="fa fa-facebook-square"></i></button>
        </section>
      </column>
    </row>
  </div>
    <% include ./partials/footer %>
    <script>
      $(document).ready(function() {
        window.fbAsyncInit = function() {
          FB.init({
            appId      : '1390511594581802',
            xfbml      : true,
            version    : 'v2.5'
          });

          FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
          });
        };
        // Load the SDK asynchronously
        (function(d, s, id){
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) {return;}
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/sdk.js";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // This is called with the results from from FB.getLoginStatus().
        function statusChangeCallback(response) {
          console.log('statusChangeCallback');
          console.log(response);
          // The response object is returned with a status field that lets the
          // app know the current login status of the person.
          // Full docs on the response object can be found in the documentation
          // for FB.getLoginStatus().
          if (response.status === 'connected') {
            // Logged into your app and Facebook.
            testAPI();
          } else if (response.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
            document.getElementById('status').innerHTML = 'Please log ' +
            'into this app.';
          } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
            document.getElementById('status').innerHTML = 'Please log ' +
            'into Facebook.';
          }
        }


         function checkLoginState() {
            FB.getLoginStatus(function(response) {
              statusChangeCallback(response);
            });
          }

          function testAPI() {
            console.log('Welcome!  Fetching your information.... ');
            FB.api('/me',{fields: "id,about,age_range,picture,bio,birthday,context,email,first_name,gender,hometown,link,location,middle_name,name,timezone,website,work"}, function(response) {
              $('.login-msg').html('You have been login in.');
              $('.fb-login-btn').html('Check your info.');
              console.log('Successful login for: ' + response.name);
              console.log('id:'+response.id);
              console.log('birthday:'+response.birthday);
              console.log('gender:'+response.gender);
              console.log('age_range:'+response.age_range);
              console.log('min_age_range:'+response.age_range.min);
              console.log('max_age_range:'+response.age_range.max);
              console.log('link:'+response.link);
              console.log('email:'+response.email);
              console.log('picture:'+response.picture);
            });
          }

          $('.fb-login-btn').click(function(e) {
            e.preventDefault();
            console.log('click');
            $('.hidden-fb-login-btn').click();
          });
        });
      </script>
  </body>
  </html>
