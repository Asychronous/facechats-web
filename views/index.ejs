<!DOCTYPE html>
<html>
<head>
  <% include ./partials/header %>
</head>
<body>
  <% include ./partials/banner %>
  <div class="landing-section">
    <row centered>
      <column cols="6" class="inner-landing-section">
        <!-- Introduction section -->
        <section class="intro-section text-centered">
          <span class="primary-color"><i class="fa fa-comment"></i> Face</span><span class="error-color">chats</span>.<br/><br/>
          Chat with the world anomously just in Facebook!<br/><br/>
          No extra apps, just use facebook messenger.<br><br/>
          <span class="login-msg error-color">Loading information of Facebook.</span>
          <br/>
          <button class="fb-login-btn" type="primary" style="display:none;">Sign up with <i class="fa fa-facebook-square"></i></button>
          <button class="fb-logout-btn" type="primary" style="display:none;">Log out <i class="fa fa-facebook-square"></i></button>
        </section>

      </column>
    </row>
  </div>
  <img class="chat-demo-img" src="./images/record.gif" alt="" />
    <% include ./partials/footer %>
    <script>
      $(document).ready(function() {
        window.fbAsyncInit = function() {
          FB.init({
            appId      : '1390511594581802',
            xfbml      : true,
            version    : 'v2.5'
          });

          FB.getLoginStatus(function(response) {
            checkLoginState();
          });
        };
        // Load the SDK asynchronously
        (function(d, s, id){
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) {return;}
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/sdk.js";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // This is called with the results from from FB.getLoginStatus().
        function loginUser(response) {
          FB.login(checkStatus, {scope: 'public_profile,email'});
        }

        function checkStatus(response) {
          var $loginMsg = $('.login-msg');
          var $fbLoginBtn = $('.fb-login-btn');

          if (response.status === 'connected') {
            getUserInfor();
            $loginMsg.html('');
          } else if (response.status === 'not_authorized') {
            $fbLoginBtn.css('display', '');
            $loginMsg.html('');
          } else {
            $fbLoginBtn.css('display', '');
            $loginMsg.html('');
          }
        }

       function checkLoginState() {
          FB.getLoginStatus(checkStatus);
        }

        function getUserInfor() {
          FB.api('/me',{fields: "id,about,age_range,picture,bio,birthday,context,email,first_name,gender,hometown,link,location,middle_name,name,timezone,website,work"}, function(response) {
            $('.login-msg').html('You have been registered as ' + response.name);
            $('.login-msg').append('<br/><br/><a style="cursor: pointer;"><span class="label label-primary" outline>Start chatting with stranger.</span></a><br/>');
            $('.fb-login-btn').css('display', 'none');
            $('.fb-logout-btn').css('display', '');
            console.log('Successful login for: ' + response.name);
            console.log('id:'+response.id);
            console.log('birthday:'+response.birthday);
            console.log('gender:'+response.gender);
            console.log('age_range:'+response.age_range);
            console.log('min_age_range:'+response.age_range.min);
            console.log('max_age_range:'+response.age_range.max);
            console.log('link:'+response.link);
            console.log('email:'+response.email);
            console.log('picture:'+response.picture);
          });
        }

        $('.fb-login-btn').click(function(e) {
          e.preventDefault();
          loginUser();
        });

        $('.fb-logout-btn').click(function(e) {
          FB.logout(function(res) {
            var $loginMsg = $('.login-msg');
            var $fbLoginBtn = $('.fb-login-btn');

            $fbLoginBtn.css('display', '');
            $('.fb-logout-btn').css('display', 'none');
            $loginMsg.html('');
          });
        });

      });
    </script>
  </body>
  </html>
